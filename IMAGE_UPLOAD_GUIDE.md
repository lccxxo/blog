# 图片上传功能使用指南

## 功能概述

博客系统现已支持图片上传功能，可以在撰写文章时上传图片，并在文章中展示。

## 功能特点

### 1. Markdown 编辑器中的图片上传

- **位置**: 创建/编辑文章页面的Markdown编辑器工具栏
- **操作**: 点击工具栏中的"上传图片"按钮
- **支持格式**: JPG, PNG, GIF, WEBP, SVG
- **文件大小限制**: 最大 5MB
- **自动插入**: 上传成功后会自动在光标位置插入Markdown图片语法

### 2. 文章封面图片上传

- **位置**: 创建/编辑文章页面的"封面图片"表单项
- **操作**: 点击"上传封面图片"按钮
- **支持格式**: JPG, PNG, GIF, WEBP
- **文件大小限制**: 最大 5MB
- **预览功能**: 上传后可以预览封面图片

## 使用步骤

### 在文章内容中插入图片

1. 在Markdown编辑器中，将光标定位到需要插入图片的位置
2. 点击工具栏中的**"上传图片"**按钮（蓝色按钮，带上传图标）
3. 选择本地图片文件
4. 等待上传完成（会显示加载状态）
5. 图片Markdown语法会自动插入到编辑器中，格式为：`![文件名](/uploads/images/日期/文件ID.ext)`
6. 切换到"预览"标签可以查看图片效果

### 上传文章封面图片

1. 在创建/编辑文章页面，找到"封面图片"表单项
2. 点击**"上传封面图片"**按钮
3. 选择本地图片文件
4. 等待上传完成
5. 图片URL会自动填入输入框
6. 可以点击"预览"按钮查看封面图片效果

## 技术实现

### 后端

- **API 端点**: `POST /api/upload/image` (需要认证)
- **存储路径**: `./uploads/images/年份/月份/日期/UUID.ext`
- **文件命名**: 使用UUID生成唯一文件名，避免冲突
- **静态服务**: `GET /uploads/*` 提供图片访问

### 前端

- **上传API**: `frontend/src/api/upload.js`
- **Markdown编辑器**: 集成上传按钮和进度显示
- **图片预览**: 使用Element Plus的Image组件
- **URL处理**: 自动将相对路径转换为完整URL

## 图片存储结构

```
uploads/
└── images/
    └── 2025/
        └── 10/
            └── 22/
                ├── uuid-1.jpg
                ├── uuid-2.png
                └── uuid-3.gif
```

按日期分类存储，便于管理和清理。

## 注意事项

1. **文件大小**: 单个图片文件不能超过 5MB
2. **支持格式**: 
   - 文章内容图片: JPG, PNG, GIF, WEBP, SVG
   - 封面图片: JPG, PNG, GIF, WEBP
3. **认证要求**: 上传图片需要登录并携带有效的JWT token
4. **存储空间**: 请定期清理不再使用的图片，避免占用过多磁盘空间
5. **备份建议**: 建议定期备份 `uploads` 目录

## 示例

### 上传成功的图片Markdown语法

```markdown
![beautiful-sunset.jpg](/uploads/images/2025/10/22/a1b2c3d4-e5f6-7890-abcd-ef1234567890.jpg)
```

### 在文章中使用

```markdown
# 我的旅行日记

今天去了海边，看到了美丽的日落：

![日落美景](/uploads/images/2025/10/22/sunset-photo.jpg)

风景非常美丽，心情也变得很好！
```

## 常见问题

### Q: 图片上传失败怎么办？

A: 请检查：
1. 是否已登录
2. 图片格式是否支持
3. 图片大小是否超过5MB
4. 网络连接是否正常

### Q: 如何删除已上传的图片？

A: 目前需要手动从服务器删除。图片存储在 `uploads/images/` 目录下，按日期分类。

### Q: 图片无法显示怎么办？

A: 请检查：
1. 后端服务器是否正在运行
2. 图片URL是否正确
3. 浏览器控制台是否有错误信息

### Q: 可以上传多大的图片？

A: 当前限制为5MB。如需修改，请在后端 `controllers/upload.go` 中调整文件大小限制。

## 未来改进

- [ ] 图片压缩和优化
- [ ] 图片管理界面（查看、删除已上传的图片）
- [ ] 拖拽上传
- [ ] 粘贴上传（从剪贴板）
- [ ] 图片裁剪和编辑
- [ ] CDN集成
- [ ] 云存储支持（OSS, S3等）

## 相关文件

- 后端控制器: `controllers/upload.go`
- 路由配置: `routes/routes.go`
- 前端API: `frontend/src/api/upload.js`
- Markdown编辑器: `frontend/src/components/MarkdownEditor.vue`
- Markdown查看器: `frontend/src/components/MarkdownViewer.vue`
- 文章创建页面: `frontend/src/views/CreateArticle.vue`



