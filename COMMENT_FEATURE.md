# 评论功能说明

## 🎉 新增评论功能

已为博客系统添加完整的评论功能，支持评论和回复。

## ✨ 功能特性

### 基础功能
- ✅ 发表评论 - 在文章下发表评论
- ✅ 查看评论 - 查看文章的所有评论
- ✅ 编辑评论 - 编辑自己的评论
- ✅ 删除评论 - 删除自己的评论
- ✅ 评论回复 - 支持嵌套回复（二级评论）
- ✅ 评论管理 - 查看和管理自己的所有评论

### 特色功能
- 🕒 智能时间显示 - "刚刚"、"5分钟前"、"2小时前"等
- 👤 用户信息展示 - 显示评论者头像和昵称
- 🔒 权限控制 - 只能编辑/删除自己的评论
- 📊 评论统计 - 显示文章评论总数
- 🎨 美观的UI - 清晰的评论列表和回复展示

## 📁 新增的文件

### 后端文件
```
models/comment.go          # 评论数据模型
controllers/comment.go     # 评论控制器
```

### 前端文件
```
frontend/src/api/comment.js                    # 评论API接口
frontend/src/components/CommentSection.vue     # 评论组件
frontend/src/views/MyComments.vue              # 我的评论页面
```

## 🔌 API 接口

### 公开接口（无需登录）

#### 获取文章评论列表
```http
GET /api/articles/:article_id/comments
```

响应示例：
```json
{
  "comments": [
    {
      "id": 1,
      "content": "很棒的文章！",
      "article_id": 1,
      "user_id": 1,
      "user": {
        "id": 1,
        "username": "user1",
        "nickname": "用户1"
      },
      "parent_id": null,
      "replies": [
        {
          "id": 2,
          "content": "感谢支持！",
          "parent_id": 1,
          "user": {...}
        }
      ],
      "created_at": "2025-01-01T10:00:00Z"
    }
  ],
  "total": 5
}
```

#### 获取单个评论
```http
GET /api/comments/:id
```

### 需要认证的接口

#### 发表评论
```http
POST /api/comments
Authorization: Bearer {token}
Content-Type: application/json

{
  "content": "评论内容",
  "article_id": 1,
  "parent_id": null  // 可选，回复评论时填写父评论ID
}
```

#### 更新评论
```http
PUT /api/comments/:id
Authorization: Bearer {token}
Content-Type: application/json

{
  "content": "更新后的评论内容"
}
```

#### 删除评论
```http
DELETE /api/comments/:id
Authorization: Bearer {token}
```

注意：删除评论会同时删除所有回复

#### 获取我的评论
```http
GET /api/my-comments?page=1&page_size=10
Authorization: Bearer {token}
```

## 💻 使用说明

### 1. 查看评论

在任何文章详情页底部都可以看到评论区，无需登录即可查看。

### 2. 发表评论

1. 登录账号
2. 访问文章详情页
3. 在评论框中输入内容
4. 点击"发表评论"按钮

### 3. 回复评论

1. 在任意评论下点击"回复"按钮
2. 输入回复内容
3. 点击"发表回复"

### 4. 编辑评论

1. 在自己的评论下点击"编辑"按钮
2. 修改内容
3. 点击"保存"

### 5. 删除评论

1. 在自己的评论下点击"删除"按钮
2. 确认删除操作

### 6. 管理评论

1. 点击顶部菜单的"我的评论"
2. 查看所有评论列表
3. 可以直接跳转到文章或删除评论

## 🎨 界面展示

### 评论区布局

```
┌─────────────────────────────────────┐
│ 评论 (5)                             │
├─────────────────────────────────────┤
│ [评论输入框]                         │
│               [发表评论]             │
├─────────────────────────────────────┤
│ 👤 用户名  3小时前                   │
│ 这是一条评论内容...                 │
│ [回复] [编辑] [删除]                │
│                                     │
│   ↳ 👤 用户2  1小时前               │
│     这是一条回复...                 │
│     [删除]                          │
│                                     │
│ 👤 用户3  1天前                     │
│ 另一条评论...                       │
│ [回复]                              │
└─────────────────────────────────────┘
```

## 📊 数据模型

### Comment 字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| ID | uint | 评论ID |
| Content | string | 评论内容 |
| ArticleID | uint | 所属文章ID |
| UserID | uint | 评论者ID |
| ParentID | *uint | 父评论ID（回复时使用） |
| CreatedAt | time.Time | 创建时间 |
| UpdatedAt | time.Time | 更新时间 |

### 关联关系

- Comment 属于 Article（多对一）
- Comment 属于 User（多对一）
- Comment 可以有多个 Replies（一对多，自关联）

## 🔧 配置说明

### 评论功能无需额外配置

评论功能已自动集成到现有系统中：
- 数据库会自动创建 `comments` 表
- 路由已自动添加
- 前端页面已自动集成

## 🚀 启动和测试

### 1. 重启服务

如果后端正在运行，需要重启：

```bash
# 方式一：使用启动脚本
.\start.bat

# 方式二：手动启动
go run main.go
```

### 2. 测试评论功能

1. 访问 http://localhost:3000
2. 登录账号
3. 打开任意文章
4. 在底部评论区发表评论
5. 尝试回复、编辑、删除等操作

## 📝 注意事项

1. **权限控制**
   - 只有登录用户才能发表评论
   - 只能编辑/删除自己的评论

2. **数据安全**
   - 评论内容会自动转义防止XSS攻击
   - 父评论被删除时，所有回复也会被删除

3. **性能优化**
   - 评论采用预加载机制，减少数据库查询
   - 只显示顶层评论，回复嵌套在内部

## 🎯 未来扩展建议

- [ ] 添加评论点赞功能
- [ ] 支持评论排序（最新、最热）
- [ ] 支持多级回复（目前仅支持二级）
- [ ] 添加评论通知功能
- [ ] 支持评论中的表情和图片
- [ ] 添加敏感词过滤
- [ ] 添加评论举报功能

## 📱 页面路由

| 路由 | 说明 | 需要登录 |
|------|------|---------|
| `/article/:id` | 文章详情（含评论区） | 否 |
| `/my-comments` | 我的评论管理 | 是 |

## 🎊 完成

评论功能已完全集成到博客系统中，现在可以开始使用了！

享受你的博客评论功能吧！✨





